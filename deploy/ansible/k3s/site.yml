---
# Sub2API K3s 集群完整部署
# 
# 使用方法:
#   1. 编辑 inventory.yml 填入服务器信息
#   2. 设置环境变量: export TAILSCALE_AUTHKEY="tskey-auth-xxx"
#   3. 执行: ansible-playbook -i inventory.yml site.yml

- name: 基础环境初始化
  import_playbook: playbooks/01-base.yml

- name: WireGuard 组网
  import_playbook: playbooks/02-wireguard.yml

- name: K3s Server (运维机)
  import_playbook: playbooks/03-k3s-server.yml

- name: K3s Agent (业务机)
  import_playbook: playbooks/04-k3s-agent.yml

- name: 监控栈 (Prometheus + Loki + Grafana + Tempo)
  import_playbook: playbooks/05-monitoring.yml

- name: Next Terminal 堡垒机
  import_playbook: playbooks/06-next-terminal.yml

- name: SSH 安全加固
  import_playbook: playbooks/07-ssh-security.yml

- name: Ingress 和自动 HTTPS
  import_playbook: playbooks/08-ingress.yml
